#!/usr/local/bin/node

const confirm = require('../lib/helpers').confirm;
const mongoose = require('mongoose');
const models = require('../lib/models');
const User = models.User;
const Post = models.Post;
const Profile = models.Profile;
const db_connection_string = process.env.DB_CONNECTION_STRING || 'mongodb://localhost/writeitdown';

const firstPostText = 'This is your first post.\n\n Log in with the default credentials to ' +
  'edit or delete it, and to start making posts of your own.';
const profileText = 'This is some profile text. Write a short intro on the profile ' +
  'page to explain who you are, and what your blog is about.\n\n You can also specify an ' +
  'image url, to fit in a 150x200 pixel area. Larger images will be squashed into the box.\n\n' +
  '*Markdown works here, too!*';

const prompt = '\n\n***WARNING: THIS OPERATION WILL DESTROY DATA!***\nAre you sure you want to seed the database at ' + db_connection_string;
confirm(prompt).then(function() {
  mongoose.connect(db_connection_string);
  return User.remove({}).exec();
}, function(err) {
  console.log(`Aborting database seed: ${err}`);
}).then(function() {
  return User.create({
    username: 'admin',
    password: 'admin'
  });
}).then(function() {
  return Post.remove({}).exec();
}).then(function() {
  return Post.create({
    title: 'Hello, world!',
    slug: 'hello-world',
    text: firstPostText,
    posted: Date.now()
  });
}).then(function() {
  return Profile.remove({}).exec();
}).then(function() {
  return Profile.create({
    text: profileText,
    image: 'http://placehold.it/150x200'
  });
}).then(function() {
  mongoose.disconnect();
});
